# Docker    

## Usage     

```
sudo docker run -d --name patriot \
    -v $HOME/patriot:/etc/patriot \
    -p 443:443 -p 80:80 \
    -e "SSL_DOMAIN=example.test" \
    -e "V2RAY_HTTP_WEBSOCKET_PATH=api" \
    -e "ACME_EMAIL=admin@example.test" \
    --cap-add=NET_ADMIN \
    --log-opt max-size=1m \
    --restart=unless-stopped \
    tarot13/patriot
```

## Useful Env Vars    
* **SSL_DOMAIN**: *Required.*    
* **ACME_EMAIL**: *Required.*    
* **V2RAY_HTTP_WEBSOCKET_PATH**: *Optional.* V2Ray websocket path. Use root path by default.    
* **V2RAY_HTTP_DEFAULT_PROXY**: *Optional.* Default proxy target for root path. Take effect only when *V2RAY_HTTP_WEBSOCKET_PATH* is set.    
* **DEFAULT_BACKEND**: *Optional.* Default backend for port 443, such as `{{GATEWAY_IP}}:4443  send-proxy` (template syntax is allowed). Use Caddy by default.    

## V2Ray    
Put your V2Ray clients into `$HOME/patriot/v2ray/clients.json`, or **one** new UUID will be generated at first startup.    
```
{ "id": "Client 1 UUID", "alterId": 32, "level": 1, "email": "Client 1 email" },
{ "id": "Client 2 UUID", "alterId": 32, "level": 1, "email": "Client 2 email" }
```

## OCserv    
**OCserv won't start at first startup.**    
For OCserv, SSL certificate and key wihch generated by Caddy are required.    
After Caddy and V2Ray ready, you should **restart container to update OCserv configuration, then OCserv will start**.

Put your CA certificate for OCserv to `$HOME/patriot/ssl/ocserv.ca.pem`, or a self-signed CA certificate will be generated to `$HOME/patriot/ca/ca.crt.pem`.    

If you want generate client certificate with this self-signed CA certificate, get into container then `gencert.sh "/etc/patriot/ca" "Patriot" "example.test" "name" "certificate_password"`.    